usesPorchTestRepo: true
commands:
  - args:
      - porchctl
      - repo
      - register
      - --namespace=rpkg-unready
      - --name=git
      - --repo-basic-password=secret
      - --repo-basic-username=nephio
      - http://gitea.gitea.svc.cluster.local:3000/nephio/porch-test
  - args:
      - porchctl
      - rpkg
      - clone
      - --namespace=rpkg-unready
      - http://gitea.gitea.svc.cluster.local:3000/nephio/test-blueprints.git/unready@unready/v1
      - --repository=git
      - --workspace=clone-1
      - unready-edit
    stdout: |
      git.unready-edit.clone-1 created
  - args:
      - porchctl
      - rpkg
      - pull
      - --namespace=rpkg-unready
      - git.unready-edit.clone-1
      - /tmp/porch-e2e/pkg-unready-git.unready-edit.clone-1
  - args:
      - kpt
      - fn
      - eval
      - --image
      - ghcr.io/kptdev/krm-functions-catalog/search-replace:v0.2.0
      - --match-kind
      - Kptfile
      - /tmp/porch-e2e/pkg-unready-git.unready-edit.clone-1
      - --
      - by-path=status.conditions[0].status
      - put-value=True
    stderr: |
      [RUNNING] "ghcr.io/kptdev/krm-functions-catalog/search-replace:v0.2.0" on 1 resource(s)
        Results:
          [info] status.conditions[0].status: Mutated field value to "\"True\""
  - args:
      - porchctl
      - rpkg
      - push
      - --namespace=rpkg-unready
      - git.unready-edit.clone-1
      - /tmp/porch-e2e/pkg-unready-git.unready-edit.clone-1
    stdout: |
      git.unready-edit.clone-1 pushed
  - args:
      - porchctl
      - rpkg
      - propose
      - --namespace=rpkg-unready
      - git.unready-edit.clone-1
    stdout: |
      git.unready-edit.clone-1 proposed
  - args:
      - porchctl
      - rpkg
      - approve
      - --namespace=rpkg-unready
      - git.unready-edit.clone-1
    stdout: |
      git.unready-edit.clone-1 approved
  - args:
      - porchctl
      - rpkg
      - copy
      - --namespace=rpkg-unready
      - --workspace=copy-2
      - git.unready-edit.clone-1
    stdout: |
      git.unready-edit.copy-2 created
  - args:
      - porchctl
      - rpkg
      - propose
      - --namespace=rpkg-unready
      - git.unready-edit.copy-2
    stdout: |
      git.unready-edit.copy-2 proposed
  - args:
      - porchctl
      - rpkg
      - approve
      - --namespace=rpkg-unready
      - git.unready-edit.copy-2
    stdout: |
      git.unready-edit.copy-2 approved
